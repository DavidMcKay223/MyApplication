@using MyApp.Application.DTOs.Medical
@using MyApp.Application.UseCases.Medical
@using MyApp.Domain.Enums.Medical
@inject IClaimUseCases ClaimUseCases

@code {
    [Parameter]
    public EventCallback OnClaimSaved { get; set; }

    private ClaimDto? Claim;

    public void Show(ClaimDto? ClaimToEdit)
    {
        Claim = ClaimToEdit ?? new ClaimDto();
        StateHasChanged();
    }

    private async Task SaveClaim()
    {
        // if (Claim!.FormId == 0)
        // {
        //     var createClaimDto = Mapper.Map<CreateClaimDto>(Claim);
        //     await ClaimUseCases.CreateClaimAsync(createClaimDto);
        // }
        // else
        // {
        //     var updateClaimDto = Mapper.Map<UpdateClaimDto>(Claim);
        //     await ClaimUseCases.UpdateClaimAsync(Claim.FormId, updateClaimDto);
        // }

        Claim = null;
        await OnClaimSaved.InvokeAsync();
    }

    private void Cancel()
    {
        Claim = null;
    }
}

@if (Claim != null)
{
    <div class="modal-backdrop">
        <div class="modal show d-block" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content" style="height: 80%;">
                    <div class="modal-header">
                        <h5 class="modal-title">@(Claim.FormId == 0 ? "Add Claim" : "Edit Claim")</h5>
                        <button type="button" class="btn-close" @onclick="Cancel"></button>
                    </div>
                    <EditForm Model="@Claim">
                        <div class="modal-body">
                            <DataAnnotationsValidator />
                            <div class="mb-3">
                                <label for="insuredIdNumber" class="form-label">Insured ID Number</label>
                                <InputText id="insuredIdNumber" class="form-control" @bind-Value="Claim.InsuredIdNumber" />
                            </div>
                            <div class="mb-3">
                                <label for="patientFirstName" class="form-label">Patient First Name</label>
                                <InputText id="patientFirstName" class="form-control" @bind-Value="Claim.Patient.FirstName" />
                            </div>
                            <div class="mb-3">
                                <label for="patientLastName" class="form-label">Patient Last Name</label>
                                <InputText id="patientLastName" class="form-control" @bind-Value="Claim.Patient.LastName" />
                            </div>
                            <div class="mb-3">
                                <label for="insuranceProgram" class="form-label">Insurance Program</label>
                                <InputSelect id="insuranceProgram" class="form-control" @bind-Value="Claim.InsuranceProgram">
                                    @foreach (var program in Enum.GetValues<InsuranceProgram>())
                                    {
                                        <option value="@program">@program</option>
                                    }
                                </InputSelect>
                            </div>
                            <div class="mb-3">
                                <label for="totalCharge" class="form-label">Total Charge</label>
                                <InputNumber id="totalCharge" class="form-control" @bind-Value="Claim.TotalCharge" />
                            </div>
                            <div class="mb-3">
                                <label for="amountPaid" class="form-label">Amount Paid</label>
                                <InputNumber id="amountPaid" class="form-control" @bind-Value="Claim.AmountPaid" />
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary" @onclick="SaveClaim">Save</button>
                            <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1050;
    }

    .modal-dialog-centered {
        max-width: 80%;
        height: 80%;
    }

    .modal-content {
        display: flex;
        flex-direction: column;
        max-height: 100%;
        overflow: hidden;
    }

    .modal-body {
        flex: 1 1 auto;
        overflow-y: auto;
        max-height: calc(100vh - 325px);
    }

    .modal-footer {
        flex-shrink: 0;
    }
</style>
